# Playwright тести для Perevir_bot

## Передумови
Тестове середовище/дані - аналогічні як для ручного тестування. Перед запуском бота переконатися, що тестовий користувач є одночасно і адміном (ADMINS параметр); користувач є підписаним на актуальні фейки.

## Підготовка
1. Встановити модулі: *npm i*
2. Додати конфігураційний файл *config.json*, з параметрами:
{
    "telegramUrl": "https://web.telegram.org/k",
    "botName": "<назва тестового бота (не юзернейм)>",
    "botId": "<айді тестового бота>",
    "moderatorsChannelName": "<назва тестового каналу для модераторів>",
    "moderatorsChannelId": "<айді тестового каналу для модераторів>"
}

## Одноразовий логін і збереження сесії
Для того, щоб тести могли логінитися в Телеграм, потрібно одноразово залогінитись вручну і зберегти сесію:
1. У файлі bot-test.spec.js розкоментувати тест 'Setup test'. Зберегти зміни.
2. Підготувати QR code сканер у додатку телеграм в телефоні (Налаштування -> Пристрої -> З'єднати з комп'ютером)
3. Запустити тест: *npx playwright test --headed*
4. Коли з'явиться QR code - вручну зісканувати телефоном
5. Дочекатися завершення тесту. Якщо все пройшло успішно, повинен згенеруватися файл storageState.json. Він буде використовуватися для того, щоб тести розпочиналися у залогіненому стані.
6. Закоментувати тест 'Setup test'. Зберегти зміни.

## Запуск тестів
Для запуску тестів у headed режимі використовується команда *npx playwright test --headed*
Документація Playwright https://playwright.dev/docs/test-cli